<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>subjourney</title>
    
    <!-- Situ Design Auth Wrapper -->
    
    
    <!-- Situ Design Inspector (development only) -->
    
    
    
    <script>
      (function(){
        try {
          window.__SITU_ENFORCE_JWT = true;
          window.__SITU_BACKEND_URL = 'https://situ-design-backend-734636647525.us-central1.run.app';
        } catch(_) {}
      })();
    </script>
    <script>
      (function(){
        try {
          // Load attestation token from local extension server
          fetch('http://127.0.0.1:7127/situ-attestation.js', { cache: 'no-store' })
            .then(r => r.ok ? r.text() : null)
            .then(code => { if (code) eval(code); })
            .catch(() => {});
        } catch(_) {}
      })();
    </script>
    <script defer src="/plugins/situ-design/situImport.bundle.js"></script>
    <script>
      // Auto-initialize inspector after bundle loads
      // Inspector will check authentication before initializing
      document.addEventListener('DOMContentLoaded', () => {
        if (typeof window.installReactClickInspector === 'function') {
          window.installReactClickInspector();
        }
      });
      // Also try immediately in case DOM is already loaded
      if (document.readyState === 'complete' || document.readyState === 'interactive') {
        if (typeof window.installReactClickInspector === 'function') {
          window.installReactClickInspector();
        }
      }

      // Periodically check attestation status (in case user logs in after page load)
      // If attestation becomes valid later, initialize the inspector
      let authCheckInterval = setInterval(() => {
        if (window.__SITU_ATTESTED === true 
            && typeof window.installReactClickInspector === 'function' 
            && !window.__reactClickInspectorInstalled) {
          window.installReactClickInspector();
        }
      }, 2000);

      // Stop checking after 5 minutes to avoid unnecessary polling
      setTimeout(() => {
        clearInterval(authCheckInterval);
      }, 300000);
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
